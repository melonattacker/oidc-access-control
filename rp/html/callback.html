<!DOCTYPE html>
<html>
<head>
    <title>Callback - ID Token Processing</title>
    <script type="text/javascript">
        window.onload = function() {
            // Parse the URL fragment to get the ID token
            const hash = window.location.hash.substr(1);
            const params = new URLSearchParams(hash);
            const idToken = params.get('id_token');
            const state = params.get('state');

            if (idToken) {
                // Display the ID token (for demonstration purposes)
                document.getElementById('idToken').textContent = idToken;

                // Send the ID token to the server for validation and processing
                fetch('/callback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ idToken: idToken })
                })
                .then(response => response.json())
                .then(data => {
                    // Handle response data
                    console.log(data);
                    document.getElementById('response').textContent = 'Login successful! User ID: ' + data.userId;
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('response').textContent = 'Error processing ID token.';
                });
            } else {
                document.getElementById('response').textContent = 'ID token not found in URL fragment.';
            }
        };
    </script>
</head>
<body>
    <h1>Callback - ID Token Processing</h1>
    <p>ID Token: <span id="idToken"></span></p>
    <p id="response"></p>
</body>
</html>
